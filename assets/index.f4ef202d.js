var ie=Object.defineProperty,ce=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var F=(o,r,s)=>r in o?ie(o,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[r]=s,L=(o,r)=>{for(var s in r||(r={}))re.call(r,s)&&F(o,s,r[s]);if(A)for(var s of A(r))de.call(r,s)&&F(o,s,r[s]);return o},H=(o,r)=>ce(o,ue(r));import{d as W,c as y,bH as pe,m as l,a4 as M,w as q,am as O,bI as w,bJ as fe,h as g,i as k,j as S,ab as m,q as h,t as Q,au as U,a_ as ge,n as C,l as N,aW as ye,aD as J,ac as he,bp as ve,bK as me,y as Se,z as be,_ as _e}from"./index.f2f4e5af.js";import{E as ze,_ as ke}from"./empty.ab6a681e.js";const Ce=o=>(Se("data-v-f2b69436"),o=o(),be(),o),Te={key:0,class:"t-title"},Re=["innerHTML"],je={class:"tips-right"},Be={key:1,class:"search-tool"},Ee={key:2,class:"opr-tool"},Ke={key:3,class:"select-container"},Oe={class:"f-success"},Pe=Ce(()=>S("div",{class:"empty-img",slot:"empty"},[S("img",{src:ke})],-1)),we=W({name:"tablePanel"}),Ne=W(H(L({},we),{props:{title:String,tree:Boolean,url:{type:[Function,Boolean],default:!1},dataValue:{type:Array,default:()=>[]},response:{type:Object,default:()=>({data:"data",list:"items",resultCode:"code",pageObj:!1,totalRow:"total"})},hasPagination:{type:Boolean,default:!0},page:{type:Object,default:()=>({pageSize:"pageSize",pageNum:"pageNum",pageObj:"",layout:"total, sizes, prev, pager, next, jumper"})},successCode:{type:[Number,String],default:200},pageSizes:{type:Array,default:()=>[10,20,30,50]},pageSize:{type:Number,default:10},selectType:{type:[Boolean,String],default:"select"},showIndex:{type:Boolean,default:!1},showExpand:{type:Boolean,default:!1},autoLoad:{type:Boolean,default:!1},selectedIds:{type:Array,default:()=>[]},checkSelectable:{type:Function,default:()=>!0},formatter:{type:[Boolean,Function],default:!1},selectText:{type:Boolean,default:!1},keyName:{type:String,default:"name"},primaryKey:{type:String,default:"id"}},emits:["on-success","onError","changePage","row-click","select-change","select","select-all","changeSize"],setup(o,{expose:r,emit:s}){const t=o,T=y(!1),R=y(0),f=y([]),c=y(),x=y([]),i=y([]),v=y(t.pageSize),p=y();r({refresh:$,search:G,clearRecord:oe,triggerRecords:B,triggerRecordsAll:D,recordRows:i}),pe(()=>{ee(),t.url&&typeof t.url=="function"?t.autoLoad&&_(l(c)):z(t.dataValue,1)});const b=M(()=>{const{pageNum:e,pageObj:a}=t.page;return a?l(c)[a][e]:l(c)[e]});M(()=>l(i).reduce((e,a)=>`${e}${a[t.keyName]}, `,"")),q(()=>t.dataValue,e=>{z(e,1)},{deep:!0}),q(()=>t.selectedIds,e=>{O(()=>{i.value=e.map(a=>Object.assign({},a)),j()})},{immediate:!0,deep:!0});function _(e){const{data:a,resultCode:n,list:d,pageObj:E,totalRow:K}=t.response;T.value=!0,typeof t.url=="function"&&t.url(e).then(u=>{const P=a?u[a]:u;T.value=!1,+u[n]==+t.successCode?(s("on-success",u),typeof t.formatter=="function"?f.value=t.formatter(u):f.value=P[d],O(()=>{j()}),E?R.value=P[E][K]:R.value=P[K]):s("onError",u)}).catch(u=>{s("onError",u),T.value=!1})}function $(){_(l(c))}function z(e,a){const n=w(e);R.value=n.length,t.hasPagination?f.value=n.slice(v.value*(a-1),v.value*a):f.value=n,O(()=>{j()})}function G(e){V(1),Object.keys(c.value).forEach(n=>{n===t.page.pageNum||n===t.page.pageSize||n in e||delete c.value[n]});const a=Object.assign({},l(c),e);c.value=w(a),t.url&&typeof t.url=="function"?_(l(c)):z(t.dataValue,1)}function X(e){s("changePage",e),V(e),t.url&&typeof t.url=="function"?_(l(c)):z(t.dataValue,e)}function I(e){s("row-click",e),B(e),t.selectType==="radio"&&(s("select-change",[e]),l(x).length>0&&p.value&&p.value.clearSelection()),p.value&&p.value.toggleRowSelection(e,i.value.some(a=>a[t.primaryKey]===e[t.primaryKey]))}function Y(e){x.value=e,t.selectType==="select"&&s("select-change",l(i))}function V(e){const{pageNum:a,pageObj:n}=t.page;n?l(c)[n][a]=e:l(c)[a]=e}function Z(e){const{pageSize:a,pageObj:n}=t.page;n?l(c)[n][a]=e:l(c)[a]=e}function ee(){const{pageSize:e,pageNum:a,pageObj:n}=t.page,d={};n?(d[n]={},d[n][e]=t.pageSize,d[n][a]=1):(d[e]=t.pageSize,d[a]=1),c.value=w(d)}function te(e,a){s("select",e,a),B(a),O(()=>{t.selectType==="radio"&&I(a)})}function ae(e){s("select-all",e),D(e),t.selectType==="radio"&&p.value&&p.value.clearSelection()}function j(){p.value&&p.value.clearSelection(),i.value=i.value.filter(e=>f.value.some(a=>a[t.primaryKey]===e[t.primaryKey])),l(i).forEach(e=>{const a=l(f).find(n=>n[t.primaryKey]===e[t.primaryKey]);a&&p.value&&p.value.toggleRowSelection(a,!0)}),s("select-change",l(i))}function le(e){return t.checkSelectable(e)}function B(e){const a=l(i).findIndex(n=>n[t.primaryKey]===e[t.primaryKey]);a>-1?t.selectType==="select"&&l(i).splice(a,1):t.selectType==="radio"?i.value=[e]:t.selectType==="select"&&i.value.push(e)}function D(e){e.length?e.forEach(a=>{l(i).find(d=>d[t.primaryKey]===a[t.primaryKey])||B(a)}):ne()}function ne(){if(l(f)&&l(f).length){const e=l(f).map(a=>a[t.primaryKey]);i.value=l(i).filter(a=>!e.includes(a[t.primaryKey])),s("select-change",l(i))}}function oe(){i.value=[],j()}function se(e){s("changeSize",e),Z(e),t.url&&typeof t.url=="function"?_(l(c)):z(t.dataValue,b.value)}return(e,a)=>{const n=ve,d=me,E=ze,K=fe;return g(),k("div",{class:he(["table-panel",{"table-panel-tree":o.tree}])},[o.title?(g(),k("div",Te,[S("span",{innerHTML:o.title},null,8,Re),S("div",je,[m(e.$slots,"head-right",{},void 0,!0)])])):h("",!0),e.$slots["search-tool"]?(g(),k("div",Be,[m(e.$slots,"search-tool",{},void 0,!0)])):h("",!0),e.$slots["opr-tool"]?(g(),k("div",Ee,[m(e.$slots,"opr-tool",{},void 0,!0)])):h("",!0),o.selectText?(g(),k("div",Ke,[Q("\u5F53\u524D\u9009"),S("span",Oe,U(l(i).length),1),Q("\u6761 ")])):h("",!0),ge((g(),C(d,ye({ref_key:"tableRef",ref:p,data:l(f),onSelectionChange:Y,onSelectAll:ae,onSelect:te,onRowClick:I},e.$attrs),{default:N(()=>[o.selectType?(g(),C(n,{key:0,type:"selection",width:"55",align:"center",selectable:le})):h("",!0),o.showIndex?(g(),C(n,{key:1,label:"\u5E8F\u53F7",width:"65",align:"center"},{default:N(u=>[S("span",null,U((l(b)-1)*l(v)+u.$index+1),1)]),_:1})):h("",!0),o.showExpand?(g(),C(n,{key:2,type:"expand"},{default:N(({row:u})=>[m(e.$slots,"expand",{row:u},void 0,!0)]),_:3})):h("",!0),m(e.$slots,"default",{},void 0,!0),Pe]),_:3},16,["data"])),[[K,l(T)]]),o.hasPagination?(g(),C(E,{key:4,"current-page":l(b),"onUpdate:currentPage":a[0]||(a[0]=u=>J(b)?b.value=u:null),"page-size":l(v),"onUpdate:pageSize":a[1]||(a[1]=u=>J(v)?v.value=u:null),small:"",background:"","page-sizes":o.pageSizes,layout:o.page.layout,total:l(R),onSizeChange:se,onCurrentChange:X},null,8,["current-page","page-size","page-sizes","layout","total"])):h("",!0),m(e.$slots,"bottom",{},void 0,!0)],2)}}}));const De=_e(Ne,[["__scopeId","data-v-f2b69436"]]);export{De as T};
