var Ge=Object.defineProperty,Ke=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var le=(i,d,n)=>d in i?Ge(i,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[d]=n,X=(i,d)=>{for(var n in d||(d={}))Xe.call(d,n)&&le(i,n,d[n]);if(te)for(var n of te(d))Ye.call(d,n)&&le(i,n,d[n]);return i},ae=(i,d)=>Ke(i,We(d));import{dz as ie,k as u,d as He,r as U,ef as Je,bm as Qe,eg as Ze,eh as eu,bo as uu,ei as tu,ej as lu,c as k,o as au,w as su,e as nu,b as ou,bn as Y,x as P,h as m,i as x,l as t,m as e,al as O,aB as z,n as E,bV as ru,t as f,bW as du,a_ as B,bX as iu,bY as H,b_ as cu,j as J,b$ as se,s as M,au as ne,aC as pu,ek as mu,dU as oe,bd as fu,q as _u,E as hu,bR as gu,bS as bu,g as Eu,bp as Fu,bK as Bu,ec as yu,ed as Cu,ee as vu,bh as wu,be as Du,_ as xu}from"./index.f2f4e5af.js";import{E as ku,a as Au}from"./radio.94706b80.js";import{E as Vu}from"./card.2dd1dae5.js";import{_ as re}from"./index.68adca3c.js";import{E as Iu}from"./image-viewer.3fecd8e6.js";import{E as Ru,a as Pu}from"./form-item.24d4e3f5.js";import{E as Tu,a as Uu}from"./col.f1267745.js";import{T as $u}from"./index.f4ef202d.js";import{u as Nu}from"./useDictTypes.39a9cb05.js";import{v as y}from"./index.06d45199.js";import{b as ju}from"./is.1291effc.js";import{j as Ou}from"./index.bf800284.js";import{_ as zu,e as de,p as Mu,d as qu}from"./index.vue_vue_type_script_setup_true_lang.fe28f24f.js";import"./empty.ab6a681e.js";const $=new Map,Lu=(i,d,n=null)=>{const F=u(zu,i);return F.appContext=n,ie(F,d),document.body.appendChild(d.firstElementChild),F.component},Su=()=>document.createElement("div"),Gu=(i,d)=>{const n=Su();i.onVanish=()=>{ie(null,n),$.delete(_)},i.onAction=g=>{const C=$.get(_);let T;T=g,g==="cancel"||g==="close"?C==null||C.reject():C==null||C.resolve(T)};const F=Lu(i,n,d),_=F==null?void 0:F.proxy;for(const g in i)Object.hasOwn(i,g)&&!Object.hasOwn(_.$props,g)&&(_[g]=i[g]);return _.visible=!0,_};function V(i,d=null){return new Promise((n,F)=>{const _=Gu(i,d!=null?d:V._context);$.set(_,{resolve:n,reject:F})})}const Ku=["show"];Ku.forEach(i=>{V[i]=Wu()});function Wu(){return(i,d)=>V(Object.assign({},i),d)}V.close=()=>{$.forEach((i,d)=>{d.doClose()}),$.clear()};V._context=null;const Xu={class:"app-container"},Yu={class:"p-15px"},Hu={key:0,class:"flex align-center justify-center"},Ju={class:"dialog-footer"},Qu=He({__name:"index",setup(i,{expose:d}){const n=U({title:"\u7528\u6237",id:"userId",isAsc:"desc",orderByColumn:"user_id",api:{list:Je,get:Qe,add:Ze,remove:eu,edit:uu,export:tu,resetPwd:lu},authorites:{list:"system:user:list",get:"system:user:query",add:"system:user:add",edit:"system:user:edit",remove:"system:user:remove",export:"system:user:export",resetPwd:"system:user:resetPwd"}}),F=(l,a,o)=>{a&&!ju(a)?o(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u7801")):o()},_=Nu(["sys_common_status","sys_user_sex","sys_passenger_idType"]),g=k(),C=k(),T=k(),N=k(!1),q=k(!0),L=k([]),A=U({username:"",status:""}),ce=U({username:[{required:!0,message:"\u7528\u6237\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:2,max:30,message:"\u7528\u6237\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 30 \u4E4B\u95F4",trigger:"blur"}],password:[{required:!0,message:"\u7528\u6237\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],status:[{required:!0,message:"\u72B6\u6001\u5FC5\u987B\u9009\u62E9",trigger:"blur"}],nickname:[{required:!0,message:"\u7528\u6237\u6635\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleIds:[{required:!0,message:"\u7528\u6237\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],phoneNumber:[{validator:F,trigger:"blur"}]});let r=U({userId:"",username:"",password:"",status:"0",remark:"",phoneNumber:"",nickname:"",sex:"",roleIds:[]});const v=U({title:"",dialogVisible:!1}),S=k({});au(()=>{w()}),su(L,l=>{pe(l.length)},{deep:!0});const w=nu(()=>{g.value&&g.value.search(X({},A))},200);function pe(l){if(l>0){q.value=!1;return}q.value=!0}function me(l){L.value=l}function fe(l){return n.api.list(ae(X({},l),{orderByColumn:n.orderByColumn,isAsc:n.isAsc}))}function _e(){ee(),j(),v.title=`\u6DFB\u52A0${n.title}`,v.dialogVisible=!0}function he(l){ee(),j(),v.title=`\u4FEE\u6539${n.title}`,v.dialogVisible=!0,be(l[n.id]).then(a=>{Object.keys(r).forEach(o=>{o in a&&(r[o]=a[o])}),r.roleIds=a.roles.map(o=>o.roleId)})}function ge(){n.api.export(A)}function be(l){return new Promise((a,o)=>{n.api.get(l).then(p=>{const{data:c}=p;c&&a(c)})})}function Ee(l){Q(l[n.id]).then(()=>{w(),P.success("\u5220\u9664\u6210\u529F")})}function Fe(){const l=L.value.map(a=>a[n.id]);Q(l.join(",")).then(()=>{w(),P.success("\u5220\u9664\u6210\u529F")})}function Q(l){return new Promise((a,o)=>{Y.confirm(`\u786E\u5B9A\u8981\u5220\u9664${n.title}\u7F16\u53F7[${l}]\u7684\u6570\u636E\u9879\u5417\uFF1F`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{n.api.remove(l).then(p=>{const{code:c}=p;c===200?a(p):o(p)})}).catch(()=>{})})}function j(){var l;(l=C.value)==null||l.resetFields(),Object.keys(r).forEach(a=>{r[a]=null}),r.status="0"}function Be(){var l;(l=T.value)==null||l.resetFields()}function ye(){Be(),w()}function Ce(){var l;(l=C.value)==null||l.validate(a=>{if(a){N.value=!0;const o=r[n.id]===null,p=o?n.api.add:n.api.edit;r.username=de(r.username),r.password=de(r.password),p(r).then(c=>{const{code:I}=c;if(I!==200){N.value=!1;return}w(),j(),v.dialogVisible=!1,N.value=!1,P.success(`${n.title}${o?"\u65B0\u589E":"\u7F16\u8F91"}\u6210\u529F`)})}})}function ve(){v.dialogVisible=!1,j()}d({handleAuthRole:xe,handleResetPwd:ke,handleAddPassenger:Ve});const we=Du(),De=ou(),Z=k();function ee(){Ou().then(l=>{const{data:a}=l;a&&(Z.value=a)})}function xe(l){const a=l.userId;De.push("/system/user-auth/role/"+a)}function ke(l){Y.prompt(`\u8BF7\u8F93\u5165"${l.username}"\u7684\u65B0\u5BC6\u7801`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/^.{5,20}$/,inputErrorMessage:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4"}).then(({value:a})=>{n.api.resetPwd({userId:l.userId,password:a}).then(o=>{const{code:p}=o;p===200&&P.success(`"${l.username}"\u7684\u5BC6\u7801\u4FEE\u6539\u6210\u529F`)})}).catch(()=>{})}function Ae(l,a){const{exposed:o}=we;o[l](a)}function Ve(l){V.show({userId:l.userId}).then(()=>{}).catch(()=>{})}function Ie(l,a){a.forEach(o=>{o.userId===l.userId&&G(l)})}function G(l){Mu(l.userId).then(a=>{if(a.code===200){const{data:o}=a;if(!o){S.value[l.userId]=[];return}S.value[l.userId]=o}})}function Re(l){V.show({userId:l.userId,id:l.passengerId}).then(()=>{G(l),P.success("\u4FDD\u5B58\u6210\u529F")}).catch(()=>{})}function Pe(l){Y.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u4E58\u8F66\u4EBA"${l.name}"\u7684\u6570\u636E\u9879\u5417\uFF1F`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{qu(l.passengerId).then(a=>{a.code===200&&(P.success("\u5220\u9664\u4E58\u8F66\u4EBA\u6210\u529F"),G(l))})}).catch(()=>{})}return(l,a)=>{const o=hu,p=Ru,c=Tu,I=gu,K=bu,b=Eu,R=Uu,ue=Pu,h=Fu,Te=re,Ue=Bu,$e=Iu,Ne=re,W=yu,je=Cu,Oe=vu,ze=Vu,Me=ku,qe=Au,Le=wu;return m(),x("div",Xu,[u(ze,{class:"mb-10px",shadow:"never"},{default:t(()=>[u(ue,{ref_key:"searchFormRef",ref:T,model:e(A)},{default:t(()=>[u(R,{gutter:20},{default:t(()=>[u(c,{span:8},{default:t(()=>[u(p,{label:"\u7528\u6237\u540D\u79F0",prop:"userName"},{default:t(()=>[u(o,{modelValue:e(A).username,"onUpdate:modelValue":a[0]||(a[0]=s=>e(A).username=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",clearable:"",maxlength:"20",onClear:e(w),onChange:e(w)},null,8,["modelValue","onClear","onChange"])]),_:1})]),_:1}),u(c,{span:8},{default:t(()=>[u(p,{label:"\u72B6\u6001",prop:"status"},{default:t(()=>[u(K,{class:"w100%",modelValue:e(A).status,"onUpdate:modelValue":a[1]||(a[1]=s=>e(A).status=s),placeholder:"\u7528\u6237\u72B6\u6001",onChange:e(w)},{default:t(()=>[u(I,{label:"\u5168\u90E8",value:""}),(m(!0),x(O,null,z(e(_).type.sys_common_status,s=>(m(),E(I,{label:s.label,value:s.value,key:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),u(c,{span:6},{default:t(()=>[u(p,null,{default:t(()=>[u(b,{type:"primary",icon:e(ru),onClick:e(w)},{default:t(()=>[f("\u67E5\u8BE2")]),_:1},8,["icon","onClick"]),u(b,{icon:e(du),onClick:ye},{default:t(()=>[f("\u91CD\u7F6E")]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),u(R,{gutter:10,class:"mb8"},{default:t(()=>[u(c,{span:1.5},{default:t(()=>[B((m(),E(b,{type:"primary",plain:"",size:"small",icon:e(iu),onClick:_e},{default:t(()=>[f("\u65B0\u589E")]),_:1},8,["icon"])),[[e(y),[e(n).authorites.add]]])]),_:1},8,["span"]),u(c,{span:1.5},{default:t(()=>[B((m(),E(b,{type:"danger",plain:"",size:"small",icon:e(H),disabled:e(q),onClick:Fe},{default:t(()=>[f("\u5220\u9664")]),_:1},8,["icon","disabled"])),[[e(y),[e(n).authorites.remove]]])]),_:1},8,["span"]),u(c,{span:1.5},{default:t(()=>[B((m(),E(b,{type:"warning",plain:"",size:"small",icon:e(cu),onClick:ge},{default:t(()=>[f("\u5BFC\u51FA")]),_:1},8,["icon"])),[[e(y),[e(n).authorites.export]]])]),_:1},8,["span"])]),_:1}),u($u,{ref_key:"tableRef",ref:g,"show-expand":!0,url:fe,"primary-key":e(n).id,onSelectChange:me,onExpandChange:Ie},{expand:t(({row:s})=>[J("div",Yu,[u(Ue,{border:"",data:e(S)[s.userId]},{default:t(()=>[u(h,{label:"\u4E58\u8F66\u4EBA\u59D3\u540D",prop:"name"}),u(h,{label:"\u624B\u673A\u53F7\u7801",prop:"phone"}),u(h,{label:"\u8BC1\u4EF6\u7C7B\u578B",prop:"idType"},{default:t(({row:D})=>[u(Te,{options:e(_).type.sys_passenger_idType,value:D.idType},null,8,["options","value"])]),_:2},1024),u(h,{label:"\u8BC1\u4EF6\u53F7\u7801",prop:"idNumber"}),u(h,{label:"\u64CD\u4F5C"},{default:t(({row:D})=>[B((m(),E(b,{size:"small",link:"",type:"primary",icon:e(se),onClick:M(Se=>Re(D),["stop"])},{default:t(()=>[f("\u4FEE\u6539")]),_:2},1032,["icon","onClick"])),[[e(y),[e(n).authorites.edit]]]),B((m(),E(b,{link:"",size:"small",type:"danger",key:D[e(n).id],icon:e(H),onClick:M(Se=>Pe(D),["stop"])},{default:t(()=>[f("\u5220\u9664")]),_:2},1032,["icon","onClick"])),[[e(y),[e(n).authorites.remove]]])]),_:2},1024)]),_:2},1032,["data"])])]),default:t(()=>[u(h,{label:"\u7528\u6237\u7F16\u53F7",prop:"userId",sortable:"custom",align:"center"}),u(h,{label:"\u7528\u6237\u8D26\u53F7",prop:"username",align:"center","show-overflow-tooltip":!0}),u(h,{label:"\u7528\u6237\u6635\u79F0",prop:"nickname",align:"center","show-overflow-tooltip":!0}),u(h,{width:"120",label:"\u7528\u6237\u5934\u50CF",prop:"phoneNumber",align:"center"},{default:t(({row:s})=>[u($e,{class:"w-50px h-50px",src:s.avatar},null,8,["src"])]),_:1}),u(h,{label:"\u72B6\u6001",align:"center"},{default:t(({row:s})=>[u(Ne,{options:e(_).type.sys_common_status,value:s.status},null,8,["options","value"])]),_:1}),u(h,{label:"\u521B\u5EFA\u65F6\u95F4",width:"150px",align:"center"},{default:t(({row:s})=>[J("span",null,ne(s.createTime&&e(pu)(s.createTime,"{y}-{m}-{d} {h}:{i}")),1)]),_:1}),u(h,{label:"\u5907\u6CE8",prop:"remark",align:"center","show-overflow-tooltip":!0}),u(h,{width:"200px",label:"\u64CD\u4F5C",align:"center","class-name":"align-center"},{default:t(({row:s})=>[s.userId!==1?(m(),x("div",Hu,[B((m(),E(b,{size:"small",link:"",type:"primary",icon:e(se),onClick:M(D=>he(s),["stop"])},{default:t(()=>[f("\u4FEE\u6539")]),_:2},1032,["icon","onClick"])),[[e(y),[e(n).authorites.edit]]]),B((m(),E(b,{link:"",size:"small",type:"danger",key:s[e(n).id],icon:e(H),onClick:M(D=>Ee(s),["stop"])},{default:t(()=>[f("\u5220\u9664")]),_:2},1032,["icon","onClick"])),[[e(y),[e(n).authorites.remove]]]),B((m(),E(Oe,{class:"ml12px",onCommand:D=>Ae(D,s)},{dropdown:t(()=>[u(je,null,{default:t(()=>[B((m(),x("div",null,[u(W,{command:"handleResetPwd",icon:e(mu)},{default:t(()=>[f("\u91CD\u7F6E\u5BC6\u7801")]),_:1},8,["icon"])])),[[e(y),[e(n).authorites.resetPwd]]]),B((m(),x("div",null,[u(W,{command:"handleAuthRole",icon:e(oe)},{default:t(()=>[f("\u5206\u914D\u89D2\u8272")]),_:1},8,["icon"])])),[[e(y),[e(n).authorites.edit]]]),B((m(),x("div",null,[u(W,{command:"handleAddPassenger",icon:e(oe)},{default:t(()=>[f("\u65B0\u589E\u4E58\u8F66\u4EBA")]),_:1},8,["icon"])])),[[e(y),[e(n).authorites.add]]])]),_:1})]),default:t(()=>[u(b,{link:"",size:"small",type:"primary",icon:e(fu)},{default:t(()=>[f("\u66F4\u591A")]),_:1},8,["icon"])]),_:2},1032,["onCommand"])),[[e(y),[e(n).authorites.resetPwd,e(n).authorites.edit]]])])):_u("",!0)]),_:1})]),_:1},8,["primary-key"])]),_:1}),u(Le,{modelValue:e(v).dialogVisible,"onUpdate:modelValue":a[10]||(a[10]=s=>e(v).dialogVisible=s),title:e(v).title,width:"550px","append-to-body":""},{footer:t(()=>[J("span",Ju,[u(b,{onClick:ve},{default:t(()=>[f("\u53D6\u6D88")]),_:1}),u(b,{type:"primary",onClick:Ce,loading:e(N)},{default:t(()=>[f(" \u786E\u5B9A ")]),_:1},8,["loading"])])]),default:t(()=>[u(ue,{ref_key:"formRef",ref:C,model:e(r),rules:e(ce),"label-width":"80px"},{default:t(()=>[u(R,null,{default:t(()=>[u(c,{span:24},{default:t(()=>[u(R,{gutter:10},{default:t(()=>[u(c,{span:12},{default:t(()=>[u(p,{label:"\u7528\u6237\u540D\u79F0",prop:"username"},{default:t(()=>[u(o,{modelValue:e(r).username,"onUpdate:modelValue":a[2]||(a[2]=s=>e(r).username=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),u(c,{span:12},{default:t(()=>[u(p,{label:"\u7528\u6237\u5BC6\u7801",prop:"password"},{default:t(()=>[u(o,{modelValue:e(r).password,"onUpdate:modelValue":a[3]||(a[3]=s=>e(r).password=s),type:"password",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5BC6\u7801",maxlength:"50","show-password":!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),u(c,{span:24},{default:t(()=>[u(R,{gutter:10},{default:t(()=>[u(c,{span:12},{default:t(()=>[u(p,{label:"\u7528\u6237\u6635\u79F0",prop:"nickname"},{default:t(()=>[u(o,{modelValue:e(r).nickname,"onUpdate:modelValue":a[4]||(a[4]=s=>e(r).nickname=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u6635\u79F0",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),u(c,{span:12},{default:t(()=>[u(p,{label:"\u624B\u673A\u53F7\u7801",prop:"phoneNumber"},{default:t(()=>[u(o,{modelValue:e(r).phoneNumber,"onUpdate:modelValue":a[5]||(a[5]=s=>e(r).phoneNumber=s),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),u(c,{span:24},{default:t(()=>[u(R,{gutter:10},{default:t(()=>[u(c,{span:12},{default:t(()=>[u(p,{label:"\u6027\u522B",prop:"sex"},{default:t(()=>[u(K,{class:"w100%",modelValue:e(r).sex,"onUpdate:modelValue":a[6]||(a[6]=s=>e(r).sex=s),placeholder:"\u7528\u6237\u6027\u522B"},{default:t(()=>[(m(!0),x(O,null,z(e(_).type.sys_user_sex,s=>(m(),E(I,{label:s.label,value:s.value,key:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),u(c,{span:12},{default:t(()=>[u(p,{label:"\u89D2\u8272",prop:"roleIds"},{default:t(()=>[u(K,{class:"w100%",modelValue:e(r).roleIds,"onUpdate:modelValue":a[7]||(a[7]=s=>e(r).roleIds=s),multiple:"",placeholder:"\u7528\u6237\u89D2\u8272"},{default:t(()=>[(m(!0),x(O,null,z(e(Z),s=>(m(),E(I,{label:s.roleName,value:s.roleId,key:s.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),u(c,{span:24},{default:t(()=>[u(p,{label:"\u72B6\u6001",prop:"status"},{default:t(()=>[u(qe,{modelValue:e(r).status,"onUpdate:modelValue":a[8]||(a[8]=s=>e(r).status=s)},{default:t(()=>[(m(!0),x(O,null,z(e(_).type.sys_common_status,s=>(m(),E(Me,{key:s.value,label:s.value},{default:t(()=>[f(ne(s.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),u(c,{span:24},{default:t(()=>[u(p,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[u(o,{modelValue:e(r).remark,"onUpdate:modelValue":a[9]||(a[9]=s=>e(r).remark=s),placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"textarea",row:2},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});const ft=xu(Qu,[["__scopeId","data-v-7f8b04f8"]]);export{ft as default};
