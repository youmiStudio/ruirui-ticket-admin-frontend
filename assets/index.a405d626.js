var $e=Object.defineProperty,ze=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var W=(h,m,n)=>m in h?$e(h,m,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[m]=n,q=(h,m)=>{for(var n in m||(m={}))je.call(m,n)&&W(h,n,m[n]);if(H)for(var n of H(m))Le.call(m,n)&&W(h,n,m[n]);return h},X=(h,m)=>ze(h,qe(m));import{d as Pe,r as V,c as _,o as Oe,w as Ge,e as He,b as We,h as p,i as x,k as l,l as t,m as e,al as Y,aB as J,n as C,bV as Xe,t as c,bW as Ye,a_ as v,bX as Je,bY as Q,b_ as Qe,j,au as Z,aC as Ze,b$ as el,s as ee,dU as ll,bd as tl,q as ul,e4 as ol,aD as le,x as L,bn as al,am as nl,E as sl,bR as rl,bS as il,g as dl,bp as cl,ec as ml,ed as pl,ee as fl,aV as _l,f as hl,e9 as bl,bh as gl,be as yl,_ as El}from"./index.f2f4e5af.js";import{E as Cl,a as Fl}from"./radio.94706b80.js";import{E as vl,c as kl,d as Dl}from"./index.b432cd84.js";import{E as Bl}from"./input-number.0737c227.js";import{E as Vl}from"./card.2dd1dae5.js";import{_ as xl}from"./index.68adca3c.js";import{E as Al,a as wl}from"./form-item.24d4e3f5.js";import{E as Rl,a as Sl}from"./col.f1267745.js";import{T as Tl}from"./index.f4ef202d.js";import{u as Nl}from"./useDictTypes.39a9cb05.js";import{r as Il,g as Ul,e as Kl,f as Ml,h as $l,i as zl}from"./index.bf800284.js";import{v as k}from"./index.06d45199.js";import"./index.aa9b144d.js";import"./empty.ab6a681e.js";const ql={class:"app-container"},jl={key:0,class:"flex align-center justify-center"},Ll={class:"dialog-footer"},Pl=Pe({__name:"index",setup(h,{expose:m}){const n=V({title:"\u89D2\u8272",id:"roleId",isAsc:"desc",orderByColumn:"role_id",api:{list:Il,get:Ul,add:Kl,remove:Ml,edit:$l,export:zl},authorites:{list:"system:role:list",get:"system:role:query",add:"system:role:add",edit:"system:role:edit",remove:"system:role:remove",export:"system:role:export"}}),T=Nl("sys_common_status"),N=_(),I=_(),P=_(),A=_(!1),U=_(!0),K=_([]),F=V({roleName:"",status:""}),te=V({roleName:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:2,max:20,message:"\u89D2\u8272\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],roleKey:[{required:!0,message:"\u6743\u9650\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleSort:[{required:!0,message:"\u89D2\u8272\u987A\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],status:[{required:!0,message:"\u72B6\u6001\u5FC5\u987B\u9009\u62E9",trigger:"blur"}]});let s=V({roleId:null,roleName:"",roleKey:"",roleSort:1,status:"0",remark:"",menuCheckStrictly:!1});const g=V({title:"",dialogVisible:!1});Oe(()=>{y()}),Ge(K,o=>{ue(o.length)},{deep:!0});const y=He(()=>{N.value&&N.value.search(q({},F))},200);function ue(o){if(o>0){U.value=!1;return}U.value=!0}function oe(o){K.value=o}function ae(o){return n.api.list(X(q({},o),{orderByColumn:n.orderByColumn,isAsc:n.isAsc}))}function ne(){w(),g.title=`\u6DFB\u52A0${n.title}`,g.dialogVisible=!0,ye()}function se(o){w(),g.title=`\u4FEE\u6539${n.title}`,g.dialogVisible=!0,ie(o[n.id]).then(u=>{Object.keys(s).forEach(r=>{r in u&&(s[r]=u[r])}),Ee(o.roleId)})}function re(){n.api.export(F)}function ie(o){return new Promise((u,r)=>{n.api.get(o).then(d=>{const{data:i}=d;i&&u(i)})})}function de(o){O(o[n.id]).then(()=>{y(),L.success("\u5220\u9664\u6210\u529F")})}function ce(){const o=K.value.map(u=>u[n.id]);O(o.join(",")).then(()=>{y(),L.success("\u5220\u9664\u6210\u529F")})}function O(o){return new Promise((u,r)=>{al.confirm(`\u786E\u5B9A\u8981\u5220\u9664${n.title}\u7F16\u53F7[${o}]\u7684\u6570\u636E\u9879\u5417\uFF1F`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{n.api.remove(o).then(d=>{const{code:i}=d;i===200?u(d):r(d)})}).catch(()=>{})})}function w(){var o;(o=I.value)==null||o.resetFields(),Object.keys(s).forEach(u=>{s[u]=null}),s.status="0",s.roleSort=1,s.menuCheckStrictly=!0,R.value=!1,S.value=!1,f.value&&f.value.setCheckedKeys([])}function me(){var o;(o=P.value)==null||o.resetFields()}function pe(){me(),y()}function fe(){var o;(o=I.value)==null||o.validate(u=>{if(u){A.value=!0;const r=s[n.id]===null,d=r?n.api.add:n.api.edit;s.menuIds=ve(),d(s).then(i=>{const{code:D}=i;if(D!==200){A.value=!1;return}y(),w(),g.dialogVisible=!1,A.value=!1,L.success(`${n.title}${r?"\u65B0\u589E":"\u7F16\u8F91"}\u6210\u529F`)})}})}function _e(){g.dialogVisible=!1,w()}const R=_(),S=_(),B=_(),he=_({children:"children",label:"label"}),f=_(),be=We(),ge=yl();m({handleAuthUser:De});function ye(){kl().then(o=>{B.value=o.data})}function Ee(o){Dl(o).then(u=>{const{data:r}=u;if(r){const{checkedKeys:d,menus:i}=r;B.value=i,d.forEach(D=>{nl(()=>{f.value&&f.value.setChecked(D,!0,!1)})})}})}function Ce(o){let u=B.value;if(!!u)for(let r=0;r<u.length;r++){if(!f.value)return;f.value.store.nodesMap[u[r].id].expanded=o}}function Fe(o){f.value&&f.value.setCheckedNodes(o?B.value:[])}function ve(){if(!f.value)return[];let o=f.value.getCheckedKeys(),u=f.value.getHalfCheckedKeys();return o.unshift.apply(o,u),o}function ke(o,u){const{exposed:r}=ge;r[o](u)}function De(o){const u=o.roleId;be.push("/system/role-auth/user/"+u)}return(o,u)=>{const r=sl,d=Al,i=Rl,D=rl,Be=il,b=dl,M=Sl,G=wl,E=cl,Ve=xl,xe=ml,Ae=pl,we=fl,Re=Vl,Se=_l,Te=hl,Ne=Bl,$=bl,Ie=vl,Ue=Cl,Ke=Fl,Me=gl;return p(),x("div",ql,[l(Re,{class:"mb-10px",shadow:"never"},{default:t(()=>[l(G,{ref_key:"searchFormRef",ref:P,model:e(F)},{default:t(()=>[l(M,{gutter:20},{default:t(()=>[l(i,{span:8},{default:t(()=>[l(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"siteName"},{default:t(()=>[l(r,{modelValue:e(F).roleName,"onUpdate:modelValue":u[0]||(u[0]=a=>e(F).roleName=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:"",maxlength:"20",onClear:e(y),onChange:e(y)},null,8,["modelValue","onClear","onChange"])]),_:1})]),_:1}),l(i,{span:5},{default:t(()=>[l(d,{label:"\u72B6\u6001",prop:"status"},{default:t(()=>[l(Be,{class:"w100%",modelValue:e(F).status,"onUpdate:modelValue":u[1]||(u[1]=a=>e(F).status=a),placeholder:"\u89D2\u8272\u72B6\u6001",onChange:e(y)},{default:t(()=>[l(D,{label:"\u5168\u90E8",value:""}),(p(!0),x(Y,null,J(e(T).type.sys_common_status,a=>(p(),C(D,{label:a.label,value:a.value,key:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),l(i,{span:8},{default:t(()=>[l(d,null,{default:t(()=>[l(b,{type:"primary",icon:e(Xe),onClick:e(y)},{default:t(()=>[c("\u67E5\u8BE2")]),_:1},8,["icon","onClick"]),l(b,{icon:e(Ye),onClick:pe},{default:t(()=>[c("\u91CD\u7F6E")]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l(M,{gutter:10,class:"mb8"},{default:t(()=>[l(i,{span:1.5},{default:t(()=>[v((p(),C(b,{type:"primary",plain:"",size:"small",icon:e(Je),onClick:ne},{default:t(()=>[c("\u65B0\u589E")]),_:1},8,["icon"])),[[e(k),[e(n).authorites.add]]])]),_:1},8,["span"]),l(i,{span:1.5},{default:t(()=>[v((p(),C(b,{type:"danger",plain:"",size:"small",icon:e(Q),disabled:e(U),onClick:ce},{default:t(()=>[c("\u5220\u9664")]),_:1},8,["icon","disabled"])),[[e(k),[e(n).authorites.remove]]])]),_:1},8,["span"]),l(i,{span:1.5},{default:t(()=>[v((p(),C(b,{type:"warning",plain:"",size:"small",icon:e(Qe),onClick:re},{default:t(()=>[c("\u5BFC\u51FA")]),_:1},8,["icon"])),[[e(k),[e(n).authorites.export]]])]),_:1},8,["span"])]),_:1}),l(Tl,{ref_key:"tableRef",ref:N,url:ae,"primary-key":e(n).id,onSelectChange:oe},{default:t(()=>[l(E,{label:"\u89D2\u8272\u7F16\u53F7",prop:"roleId",sortable:"custom",align:"center"}),l(E,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName",align:"center","show-overflow-tooltip":!0}),l(E,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey",align:"center","show-overflow-tooltip":!0}),l(E,{label:"\u663E\u793A\u987A\u5E8F",prop:"roleSort",align:"center","show-overflow-tooltip":!0}),l(E,{label:"\u72B6\u6001",align:"center"},{default:t(({row:a})=>[l(Ve,{options:e(T).type.sys_common_status,value:a.status},null,8,["options","value"])]),_:1}),l(E,{label:"\u521B\u5EFA\u65F6\u95F4",width:"150px",align:"center"},{default:t(({row:a})=>[j("span",null,Z(a.createTime&&e(Ze)(a.createTime,"{y}-{m}-{d} {h}:{i}")),1)]),_:1}),l(E,{label:"\u5907\u6CE8",prop:"remark",align:"center","show-overflow-tooltip":!0}),l(E,{width:"200px",label:"\u64CD\u4F5C",align:"center","class-name":"fixed-width"},{default:t(({row:a})=>[a.roleId!==1?(p(),x("div",jl,[v((p(),C(b,{size:"small",link:"",type:"primary",icon:e(el),onClick:ee(z=>se(a),["stop"])},{default:t(()=>[c("\u4FEE\u6539")]),_:2},1032,["icon","onClick"])),[[e(k),[e(n).authorites.edit]]]),v((p(),C(b,{link:"",size:"small",type:"danger",key:a[e(n).id],icon:e(Q),onClick:ee(z=>de(a),["stop"])},{default:t(()=>[c("\u5220\u9664")]),_:2},1032,["icon","onClick"])),[[e(k),[e(n).authorites.remove]]]),v((p(),C(we,{class:"ml12px",onCommand:z=>ke(z,a)},{dropdown:t(()=>[l(Ae,null,{default:t(()=>[v((p(),x("div",null,[l(xe,{command:"handleAuthUser",icon:e(ll)},{default:t(()=>[c("\u5206\u914D\u7528\u6237")]),_:1},8,["icon"])])),[[e(k),[e(n).authorites.edit]]])]),_:1})]),default:t(()=>[l(b,{link:"",size:"small",type:"primary",icon:e(tl)},{default:t(()=>[c("\u66F4\u591A")]),_:1},8,["icon"])]),_:2},1032,["onCommand"])),[[e(k),[e(n).authorites.edit]]])])):ul("",!0)]),_:1})]),_:1},8,["primary-key"])]),_:1}),l(Me,{modelValue:e(g).dialogVisible,"onUpdate:modelValue":u[10]||(u[10]=a=>e(g).dialogVisible=a),title:e(g).title,width:"500px","append-to-body":""},{footer:t(()=>[j("span",Ll,[l(b,{onClick:_e},{default:t(()=>[c("\u53D6\u6D88")]),_:1}),l(b,{type:"primary",onClick:fe,loading:e(A)},{default:t(()=>[c(" \u786E\u5B9A ")]),_:1},8,["loading"])])]),default:t(()=>[l(G,{ref_key:"formRef",ref:I,model:e(s),rules:e(te),"label-width":"100px"},{default:t(()=>[l(M,null,{default:t(()=>[l(i,{span:24},{default:t(()=>[l(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:t(()=>[l(r,{modelValue:e(s).roleName,"onUpdate:modelValue":u[2]||(u[2]=a=>e(s).roleName=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:24},{default:t(()=>[l(d,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey"},{label:t(()=>[j("span",null,[l(Te,{content:"\u63A7\u5236\u5668\u4E2D\u5B9A\u4E49\u7684\u6743\u9650\u5B57\u7B26\uFF0C\u5982\uFF1A@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:t(()=>[l(Se,{size:14},{default:t(()=>[l(e(ol))]),_:1})]),_:1}),c(" \u6743\u9650\u5B57\u7B26 ")])]),default:t(()=>[l(r,{modelValue:e(s).roleKey,"onUpdate:modelValue":u[3]||(u[3]=a=>e(s).roleKey=a),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:24},{default:t(()=>[l(d,{label:"\u89D2\u8272\u987A\u5E8F",prop:"roleSort"},{default:t(()=>[l(Ne,{modelValue:e(s).roleSort,"onUpdate:modelValue":u[4]||(u[4]=a=>e(s).roleSort=a),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:24},{default:t(()=>[l(d,{class:"form-block",label:"\u83DC\u5355\u6743\u9650"},{default:t(()=>[l($,{modelValue:e(R),"onUpdate:modelValue":u[5]||(u[5]=a=>le(R)?R.value=a:null),onChange:Ce},{default:t(()=>[c("\u5C55\u5F00/\u6298\u53E0")]),_:1},8,["modelValue"]),l($,{modelValue:e(S),"onUpdate:modelValue":u[6]||(u[6]=a=>le(S)?S.value=a:null),onChange:Fe},{default:t(()=>[c("\u5168\u9009/\u5168\u4E0D\u9009")]),_:1},8,["modelValue"]),l($,{modelValue:e(s).menuCheckStrictly,"onUpdate:modelValue":u[7]||(u[7]=a=>e(s).menuCheckStrictly=a)},{default:t(()=>[c("\u7236\u5B50\u8054\u52A8")]),_:1},8,["modelValue"]),l(Ie,{class:"tree-border",data:e(B),"show-checkbox":"",ref_key:"menu",ref:f,"node-key":"id","check-strictly":!e(s).menuCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:e(he)},null,8,["data","check-strictly","props"])]),_:1})]),_:1}),l(i,{span:24},{default:t(()=>[l(d,{label:"\u72B6\u6001",prop:"status"},{default:t(()=>[l(Ke,{modelValue:e(s).status,"onUpdate:modelValue":u[8]||(u[8]=a=>e(s).status=a)},{default:t(()=>[(p(!0),x(Y,null,J(e(T).type.sys_common_status,a=>(p(),C(Ue,{key:a.value,label:a.value},{default:t(()=>[c(Z(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{span:24},{default:t(()=>[l(d,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[l(r,{modelValue:e(s).remark,"onUpdate:modelValue":u[9]||(u[9]=a=>e(s).remark=a),placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"textarea",row:2},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});const nt=El(Pl,[["__scopeId","data-v-925215cb"]]);export{nt as default};
